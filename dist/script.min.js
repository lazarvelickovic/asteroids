"use strict";var startDate,endDate,startDateMiliseconds,endDateMiliseconds,dateDifference,closeApproach,filteredCloseApproach,dateData,_this=void 0,showAsteroids=document.getElementById("showAsteroids"),asteroidTable=document.getElementById("asteroidTable"),tableContent=document.getElementById("tableContent"),autocompleteBox=document.getElementById("autocompleteBox"),datalistAsteroids=document.getElementById("datalistAsteroids"),inputDatalist=document.getElementById("inputDatalist"),choosenAsteroids=document.getElementById("choosenAsteroids"),numOfPasses=document.getElementById("numOfPasses"),backButton=document.getElementById("backButton"),asteroidChartContainer=document.getElementById("asteroidChartContainer"),asteroidData=[],asteroidCloseAproachArray=[],asteroidChartArray=[],fetchAsteroidData=function(e){fetch(e).then(function(e){return e.json()}).then(function(e){var t=e.near_earth_objects;for(var a in t)asteroidData.push(t[a].filter(function(e){return!0===e.is_potentially_hazardous_asteroid}));createTable()})},fetchCloseAproachAsteroidData=function(){var e=0;choosenAsteroids.childNodes.forEach(function(t){fetch(t.dataset.self).then(function(e){return e.json()}).then(function(t){e++,t.close_approach_data.map(function(){closeApproach=t.close_approach_data.map(function(e){if(Number(e.close_approach_date.substring(0,4))>=1900&&Number(e.close_approach_date.substring(0,4))<=1999)return!0}),filteredCloseApproach=closeApproach.filter(function(e){return null!=e})}),asteroidCloseAproachArray.push({name:t.name,numberOfPasses:filteredCloseApproach.length}),e===choosenAsteroids.childNodes.length&&(sessionStorage.setItem("asteroidCloseAproachArray",JSON.stringify(asteroidCloseAproachArray)),setTimeout(function(){window.location.assign("asteroids-chart.html")},100))})})},formValidation=function(){return isNaN(startDateMiliseconds)||isNaN(endDateMiliseconds)?(alert("Please fill both inputs"),!1):dateDifference>7?(alert("The difference between dates must be maximum 7 days!"),!1):dateDifference<0?(alert("The start date must be before end date and difference between dates must be maximum 7 days!"),!1):void fetchAsteroidData("https://api.nasa.gov/neo/rest/v1/feed?start_date=".concat(startDate,"&end_date=").concat(endDate,"&api_key=x0HeIJzRCLm3lj0zrfXt2LltusKVCO7aoHmRkVq2"))},createTable=function(){asteroidData.forEach(function(e){e.forEach(function(e){tableContent.innerHTML+="<tr>\n                                        <td>".concat(e.close_approach_data[0].close_approach_date,"</td>\n                                        <td>").concat(e.name,"</td>\n                                        <td>").concat(e.close_approach_data[0].relative_velocity.kilometers_per_hour,"</td>\n                                        <td>").concat(e.estimated_diameter.meters.estimated_diameter_min,"</td>\n                                        <td>").concat(e.estimated_diameter.meters.estimated_diameter_max,"</td>\n                                       </tr>"),datalistAsteroids.innerHTML+="<option value='".concat(e.name,"' data-name='").concat(e.name,"' data-self='").concat(e.links.self,"'>")})}),tableContent.innerHTML&&(asteroidTable.style.display="table",autocompleteBox.style.display="flex"),addPagerToTables("#asteroidTable",10)},getCellValue=function(e,t){return e.children[t].innerText||e.children[t].textContent},comparer=function(e,t){return function(a,n){return o=getCellValue(t?a:n,e),r=getCellValue(t?n:a,e),""===o||""===r||isNaN(o)||isNaN(r)?o.toString().localeCompare(r):o-r;var o,r}};function addPagerToTables(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;e="string"==typeof e?document.querySelectorAll(e):e;var a=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(a=(r=s.next()).done);a=!0){addPagerToTable(r.value,t)}}catch(e){n=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}}function addPagerToTable(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=e.querySelectorAll("tBody tr"),n=Math.ceil(a.length/t),o=[].slice.call(e.querySelector("tr").cells).reduce(function(e,t){return e+parseInt(t.colSpan)},0);if(e.createTFoot().insertRow().innerHTML="<td colspan=".concat(o,'><div class="nav" id="nav"></div></td>'),1!=n){for(var r=0;r<n;r++){var s=r+1;e.querySelector(".nav").insertAdjacentHTML("beforeend",'<a href="#" rel="'.concat(r,'">').concat(s,"</a> "))}changeToPage(e,1,t);var i=!0,d=!1,c=void 0;try{for(var l,u=e.querySelectorAll(".nav a")[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){l.value.addEventListener("click",function(a){return changeToPage(e,parseInt(a.target.innerHTML),t)})}}catch(e){d=!0,c=e}finally{try{i||null==u.return||u.return()}finally{if(d)throw c}}}}function changeToPage(e,t,a){for(var n=(t-1)*a,o=n+a,r=e.querySelectorAll(".nav a"),s=e.querySelectorAll("tBody tr"),i=0;i<r.length;i++){i==t-1?r[i].classList.add("active"):r[i].classList.remove("active");for(var d=0;d<s.length;d++)s[d].style.display=d>=n&&d<o?"table-row":"none"}}var deleteAsteroidsFromList=function(){var e=document.getElementsByClassName("delete-from-list");Array.from(e).forEach(function(e){e.addEventListener("click",function(e){datalistAsteroids.innerHTML+="<option value='".concat(e.target.parentElement.childNodes[0].nodeValue,"' data-name='").concat(e.target.parentElement.dataset.name,"' data-self='").concat(e.target.parentElement.dataset.self,"'>"),e.target.parentElement.remove(),choosenAsteroids.innerHTML||(choosenAsteroids.style.border="none")})})};document.getElementById("indexPage")&&(window.addEventListener("load",function(){(dateData=JSON.parse(sessionStorage.getItem("dateData")))&&showAsteroids.click()}),showAsteroids.addEventListener("click",function(){dateData?(startDate=dateData.startDate,endDate=dateData.endDate,document.getElementById("startDate").value=dateData.startDate,document.getElementById("endDate").value=dateData.endDate,dateData=null):(startDate=document.getElementById("startDate").value,endDate=document.getElementById("endDate").value),sessionStorage.setItem("dateData",JSON.stringify({startDate:startDate,endDate:endDate})),startDateMiliseconds=new Date(startDate).getTime(),endDateMiliseconds=new Date(endDate).getTime(),dateDifference=Math.round((endDateMiliseconds-startDateMiliseconds)/864e5),tableContent.innerHTML="",asteroidData=[],document.getElementsByTagName("tfoot")[0]&&(document.getElementsByTagName("tfoot")[0].innerHTML=""),datalistAsteroids.innerHTML="",asteroidTable.style.display="none",autocompleteBox.style.display="none",choosenAsteroids.innerHTML="",choosenAsteroids.style.border="none",document.getElementById("nav")&&(document.getElementById("nav").innerHTML=""),formValidation()}),inputDatalist.addEventListener("change",function(){datalistAsteroids.childNodes.forEach(function(e){e.dataset.name===inputDatalist.value&&(choosenAsteroids.innerHTML+="<li data-name='".concat(e.dataset.name,"' data-self='").concat(e.dataset.self,"'>").concat(inputDatalist.value,"<span class='delete-from-list'>x</span></li>"),choosenAsteroids.style.border="1px solid #34C7A0",datalistAsteroids.childNodes.forEach(function(e){inputDatalist.value===e.value&&e.remove()}))}),inputDatalist.value="",deleteAsteroidsFromList()}),numOfPasses.addEventListener("click",function(){choosenAsteroids.childNodes.length?(asteroidCloseAproachArray=[],fetchCloseAproachAsteroidData()):alert("Please choose asteroids from table")}),document.querySelectorAll("th").forEach(function(e){return e.addEventListener("click",function(){var t=e.closest("table").querySelector("tbody");Array.from(t.querySelectorAll("tr")).sort(comparer(Array.from(e.parentNode.children).indexOf(e),this.asc=!this.asc)).forEach(function(e){return t.appendChild(e)})})}));var animateChartBar=function(e,t){var a=0,n=setInterval(function(){a>=t?clearInterval(n):(a++,e.style.width=a+"%")},10)},showChartBar=function(){var e=document.getElementsByClassName("chart-asteroid-bar");[].forEach.call(e,function(e){var t=Number(e.innerHTML);e.style.backgroundColor=t<=25?"#78f038":25<t&&t<=45?"#ecf53b":45<t&&t<=75?"#f07538":"#f02416",animateChartBar(e,t)})},showChart=function(){(asteroidChartArray=JSON.parse(sessionStorage.getItem("asteroidCloseAproachArray"))).forEach(function(e){asteroidChartContainer.innerHTML+='<div class="chart-container"><div class="chart-asteroid-name">'.concat(e.name,'</div><div class="chart-asteroid-bar">').concat(e.numberOfPasses,"</div></div>")}),showChartBar()};document.getElementById("asteroidsChartPage")&&(backButton.addEventListener("click",function(){sessionStorage.removeItem("asteroidCloseAproachArray"),setTimeout(function(){window.location.assign("index.html")},100)}),window.addEventListener("load",showChart()));